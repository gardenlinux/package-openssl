From db08afde02ec9f7a64335ae81f0e03de3723f7a6 Mon Sep 17 00:00:00 2001
From: Richard Levitte <levitte@openssl.org>
Date: Wed, 5 Jun 2024 21:43:01 +0200
Subject: [PATCH 126/228] Configure: make absolutedir() use rel2abs() on
 Windows too

perl's realpath() seems to be buggy on Windows, so we turn to rel2abs()
there as well.

Fixes #23593

Reviewed-by: Neil Horman <nhorman@openssl.org>
Reviewed-by: Tomas Mraz <tomas@openssl.org>
(Merged from https://github.com/openssl/openssl/pull/24569)

(cherry picked from commit 6e01d3114b77c82cf83a2bfe53f7ba97840fbe36)
---
 Configure | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/Configure b/Configure
index 0e649a890c..a6dffde9e4 100755
--- a/Configure
+++ b/Configure
@@ -3394,6 +3394,13 @@ sub absolutedir {
         return rel2abs($dir);
     }
 
+    # realpath() on Windows seems to check if the directory actually exists,
+    # which isn't what is wanted here.  All we want to know is if a directory
+    # spec is absolute, not if it exists.
+    if ($^O eq "MSWin32") {
+        return rel2abs($dir);
+    }
+
     # We use realpath() on Unix, since no other will properly clean out
     # a directory spec.
     use Cwd qw/realpath/;
-- 
2.39.5 (Apple Git-154)

